# Playing Card
---

게임 구성 데이터를 조합하여 룰이 다른 포커 게임들을 구현한다.

## 개발 동기
---

서비스 중인 게임에 미니게임으로 플레잉 카드를 활용하는 게임을 만들 때 
비슷한 룰의 게임을 매번 새로 만드는 것이 시간이 매우 아깝다는 생각이 들어 
설정만으로도 게임룰이 다르게 적용되는 플레잉카드 전용 로직이 있으면 좋겠다는 생각을 하게 되었다.

데이터는 작성하기 쉬운 ScriptableObject 로 만들고 
각 데이터를 조합하여 포커 게임 한 가지를 구성한다.
룰이 다른 새로운 포커를 추가할 경우 코드를 변경하는것이 아닌 
구성데이터를 변경하여 새로운 포커게임을 추가 할 수 있다면, 상당히 편할 것 같았다.


## 개발 목표
---

VContainer와 MessagePipe 만을 이용하여 DI 를 최대한 사용하는 구조로 개발한다.

### 1. 1차 목표
+ 설정 데이터를 구성하고 Vcontainer 를 활용해 게임을 초기화하고 실행한다.
+ 설정 데이터만을 이용해 텍사스 홀덤을 구현한다.

### 2. 2차 목표
+ 설정 데이터만을 이용해 세븐 스터드를 구현한다.

### 3. 3차 목표
+ 설정 데이터만을 이용해 파이브 카드 드로우를 구현한다.


## 개발 이슈
---

### 포커에 대한 이해부족
+ 포커 게임에 대한 이해가 부족한 상태에서 새운 개발 목표가 가장 큰 걸림돌이 되었다. 
다양한 포커 게임들이 있지만, 카드를 나눠주는 방식만 다르고 베팅은 동일한 룰로 진행되는 것이라 여기고 있었는데, 
포커의 종류에 따라 카드를 나눠주는 방식도 다를 뿐더러 베팅 방식도 다르다는 것을 알게 되었다.
+ 포커 종류에 따라 다양한 베팅규칙으로 인해 간단한 설정으로 규칙을 구분하기가 어려워 졌다.
그래서 일단은 처음 구현한 텍사스 홀덤의 베팅규칙을 다른 포커에도 동일하게 적용하기로 결정한 대신
각 게임 특유의 시작 베팅(블라인드, 엔티)정도만 구현하는 것으로 목표를 수정하였다.

### Vcontainer 경험 부족
+ 회사에서 진행하던 프로젝트도 DI 프레임워크(ZenJect)를 도입하려고 하였으나, IoC 에대한 이해부족과 
부족한 게발기간으로 인해 폐기되면서 DI의 경험을 쌓을 기회가 날아가게 되었다. 아쉽지만, 간단한 게임을 만들면서 DI를 적용해 보기로 하고 
Playing Card 에서 처음으로 사용해 보았다. 
+ 이전 같으면 Singleton 패턴으로 매니저를 두고 필요한 값들을 가져오는 방식으로 개발을 했을것이나, 
DI를 철저히 지키고 MVP도 최대한 적용해 보고 싶어 최대한 Vcontainer만을 활용해 필요한 데이터를 가져오다 보니 개발 기간이 늘어지기 시작했다.
그래도 코파일럿을 이용해 예제들을 쉽게 찾을 수 있어서 개발이 아주 어렵지는 않았다.

### MessagePipe 의존도 증가
+ Vcontainer 를 이용해 필요 데이터드를 주입받고, UI에서는 MessagePipe 를 이용한 구독방식으로만 처리하려 하였으나. 
버튼이벤트 결과를 처리 할 때도 MessagePipe를 이용하는 것이 상당히 편리하다 보니 의존성이 매우 높아 졌다.
+ MessagePipe 의존도가 높아지면서 Message용 Struct 의 개수가 많아졌다. 추후 Message용 Struct들을 통합하고 
메시지 종류를 enum으로 관리하는 것도 고려해야 할 것 같다.

## 게임 구성 방법
---

아래 ScriptableObject 를 조합하여 포커게임을 구성 할 수 있다.

### Game
+ Create>GameData>Game 로 생성 가능
+ Main Menu 에서 게임 이름과 설명을 설정할 수 있고, Game에서 사용할 카드 정보(GameDeck) 룰 정보(GameRule)를 설정한다.
+ GameDeck, GameRule 은 필수 정보이다.

### GameDeck
+ Create>GameData>Deck 로 생성 가능
+ 게임에서 사용 할 카드들의 정보를 설정 할 수 있다. WildCardCount 로 덱에서 사용할 Wild Card 장수를 정한다.
+ GameSuits 를 추가해 Wild Card 가 아닌 일반 카드들을 구성 할 수 있다.

### GameSuits
+ Create>GameData>Suit 로 생성 가능
+ Wild Card를 제외한 카드를 설정할 수 있다.
+ SuitType 에서 Spades, Hearts, Diamonds, Clubs 을 정할 수 있다.
+ Multiply 에서 이 Suit 의 중복 벌 수를 정할 수 있다. 예를 들어 2를 입력하면 지정한 카드들이 각각 2장씩 들어간다.
+ MinValue, MaxValue 를 이용해 Deck에 등록할 카드의 범위를 지정한다.
+ 1, 14 는 어떤 값이 들어가든 Ace가 등록된다. 둘다 있어도 등록되는 것은 1장이다.

### GameRule
+ Create>GameData>Rule 로 생성 가능
+ 게임 시작 최소 인원과 최대 인원 설정, 최소 Raise 금액 설정.
+ 게임 라운드별 정보(GameRound)를 설정한다. 

### GameRound
+ Create>GameData>Round 로 생성 가능
+ RoundName 을 비워두면 GameRule 에 등록된 순서대로 번호로 표시된다.
+ Blind 해당 라운드에서 Blind 베팅 규칙을 적용한다.
+ Ante 해당 라운드에서 Ante를 적용한다.
+ BurnCardCount 는 해당 라운드 시작시 Burn을 적용할 카드 수이다.
+ DrawCardCount 는 해당 라운드에서 카드를 받은 후 한 번에 Draw를 할 수 있는 최대 카드 수 이다.
+ DealCards 에 등록된 DealCardInfo 개수 만큼 카드를 나눠준다.

### DealCardInfo
+ Create>GameData>DealCard 로 생성 가능
+ DealTarget 은 카드를 나눠줄 대상을 정한다. Table 로 하면 ComunityCard 로 사용된다.
+ DealFace 는 나눠주는 카드의 공개 여부이다. FaceDown으로 주면 받은 사람만 확인 가능하다.
Table이 대상일 경우 DealFace는 관계없이 공개 한다.

## 게임 등록 방법
---

위에서 구성한 게임을 StartUp Scene 에있는 ApplicationController 에 등록한다.

## 플레이 방법
---

아직 멀티 플레이 기능이 구현되지 않았고, AI도 추가되지 않은 상태라 각 플레이어 별로 Turn을 돌아가며 플레이 한다.
TurnAction을 하면, 카메라가 이동하며 각 플레어의 Hand를 보여준다. 자신이 현재 할 수 있는 액션이 좌측 하단에 보여진다.

## 추후 목표
---

### Betting Rule 추가
+ 현재는 Betting을 별도의 설정에 따라 진행하는게 아니라 텍사스 홀덤의 베팅규칙을 동일하게 적용하고 있다. 
이 부분도 설정으로 적용할 수 있게 하고 싶다.

### Multiplay 추가
+ Netcode 를 활용한 Mubliplay 기능 추가.

## 개발 후기
---

대략 2주 정도의 기간동안 개발을 하였다. 처음 구상을 할 때는 보드게임도 만들 수 있을 정도로 설정조합을 구상했었다.
그러나 가장 대표적인 홀덤을 구현하면서도 게임 구성 데이터들의 맴버 변수가 늘어나는 것을 보며, 
보드게임까지 아우르려면 개발 난이도를 떠나 구성의 복잡성이 매우 올라갈 것 같아 범위를 포커한정으로 줄였다.

그럼에도 불구하고 게임 구성 데이터에서 베팅룰의 누락이 불가피했고, 급하게 설계한 티가 나는 어설픈 IoC는 코드의 복잡도만 높여 버렸다. 그나마 MVP는 어느정도 지켜지긴 했지만, 썩 마음에 드는 구성은 아니다.

과거 진행했던 프로젝트들은 SingleTon 패턴 의존도가 매우 높았다. 
한 번 생성한 SingleTon은 다른 객체들과의 의존성 문제 때문에 삭제하기도 용의치 않았다.
늘어만 가는 메모리 사용량은 최적화에 큰 걸림돌이 되었다. 
특히 라이브 서비스를 오래 했다면 점점더 비대해 지는 SingleTon은 게임 최적화시 항상 고민 거리였다.
그런데, Vcontiner 는 이 부분에 있어 큰 기대감을 줍니다. 
특히 Scoped 로 관리하고, DI를 이용해 의존성을 줄인다면 메모리 관리에 많은 잇점을 가져올 수 있을 거란 기대감이 생겼습니다.

포커게임을 개발하면서 학부생들의 과제물 정도의 난이도 일거라 쉽게 생각했었지만,
조금이라도 더 빠른 핸드랭킹 판별을 위한 다양한 알고리즘이 있다는 것도 알게 되었고, 
베팅룰이 게임에 따라 이렇게 다양하게 있다는 것도 처음 알았습니다.
그리고 UI를 좀더 알아보기 쉽게 구성하려면 많은 고민이 필요하다는걸 느꼈습니다.